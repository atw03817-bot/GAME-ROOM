# ๐ง ุฅุตูุงุญ ูุดููุฉ ุฅูุดุงุก ุทูุจ Tabby - ููุฎุต ุงูุชุบููุฑุงุช

## ุงููุดููุฉ ุงูุฃุตููุฉ:
```
POST http://localhost:5000/api/orders 500 (Internal Server Error)
ุฎุทุฃ ูู ุงูุฎุงุฏู: ุฎุทุฃ ูู ุฅูุดุงุก ุงูุทูุจ
```

## ุงูุฃุณุจุงุจ ุงูููุชุดูุฉ ูุงูุญููู:

### 1. โ Order Model ูุง ูุฏุนู 'tabby'
**ุงููุดููุฉ**: Order model ูุงู ูุญุชูู ุนูู enum ูุญุฏูุฏ ูุง ูุดูู 'tabby'
```javascript
// ูุจู ุงูุฅุตูุงุญ
enum: ['cod', 'tap', 'stripe', 'tamara']
```

**ุงูุญู**: โ ุชู ุฅุถุงูุฉ 'tabby' ููู enum
```javascript
// ุจุนุฏ ุงูุฅุตูุงุญ
enum: ['cod', 'tap', 'stripe', 'tamara', 'tabby']
```

### 2. โ ุญููู ูุทููุจุฉ ูุงูุตุฉ ูู Tabby API
**ุงููุดููุฉ**: TabbyPaymentService ูู ููู ูุฑุณู ุฌููุน ุงูุญููู ุงููุทููุจุฉ ุญุณุจ ุงููุซุงุฆู ุงูุฑุณููุฉ

**ุงูุญู**: โ ุชู ุชุญุฏูุซ `formatSessionData` ูุชุดูู:
- `buyer_history` (ูุทููุจ)
- `order.updated_at` (ูุทููุจ)
- `shipping_address.zip` (ูุทููุจ)
- `items.category` (ูุทููุจ)
- `meta` object
- ุชุญุณูู ุชูุณูู ุฑูู ุงูุฌูุงู

### 3. โ ุชูุณูู ุฑูู ุงูุฌูุงู ุฎุงุทุฆ
**ุงููุดููุฉ**: Tabby ูุชุทูุจ ุฑูู ุงูุฌูุงู ุจุตูุบุฉ `5XXXXXXXX` ูููุณ `+966XXXXXXXXX`

**ุงูุญู**: โ ุชู ุชุตุญูุญ `formatPhoneNumber` ูู TabbyPaymentService
```javascript
// ูุจู: +966501234567
// ุจุนุฏ: 501234567
```

### 4. โ ููุทู ุญุณุงุจ ุงูุนูููุฉ
**ุงููุดููุฉ**: ูุงู ูุญุงูู ุญุณุงุจ ุนูููุฉ ุชูุงุฑุง ุญุชู ูุทูุจุงุช Tabby

**ุงูุญู**: โ ุชู ุฅุถุงูุฉ ููุทู ูููุตู ูู Tabby
```javascript
// ุฅุถุงูุฉ ุฏุนู ุนูููุฉ Tabby (ุฅุฐุง ูุฒู ุงูุฃูุฑ)
let tabbyCommission = {
  amount: 0,
  rate: 0,
  displayName: 'ุนูููุฉ ุงูุชูุณูุท - ุชุงุจู'
};
```

## ุงููููุงุช ุงูููุญุฏุซุฉ:

### Backend Files:
1. **`backend/services/tabbyPaymentService.js`**
   - โ ุชุญุฏูุซ `formatSessionData` ูุน ุฌููุน ุงูุญููู ุงููุทููุจุฉ
   - โ ุฅุตูุงุญ `formatPhoneNumber` ููุตูุบุฉ ุงูุตุญูุญุฉ
   - โ ุฅุถุงูุฉ `buyer_history`, `meta`, ูุญููู ุฃุฎุฑู ูุทููุจุฉ

2. **`backend/models/Order.js`**
   - โ ุฅุถุงูุฉ 'tabby' ูู paymentMethod enum

3. **`backend/controllers/orderController.js`**
   - โ ุฅุถุงูุฉ ููุทู ุนูููุฉ Tabby
   - โ ุชุญุฏูุซ ุชุนูููุงุช ุงููุฎุฒูู ูุงูุดุญู ูุชุดูู Tabby

## ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญุงุช:

### 1. ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงูุทูุจ:
```bash
# ุงูุชุญ TEST_TABBY_ORDER_CREATION.html ูู ุงููุชุตูุญ
# ุฃุฏุฎู ุฑูุฒ ุงููุตุงุฏูุฉ
# ุงุถุบุท "ุงุฎุชุจุงุฑ ุฅูุดุงุก ุทูุจ Tabby"
```

### 2. ุงุฎุชุจุงุฑ Tabby Checkout:
```bash
# ูู ููุณ ุงูููู
# ุงุถุบุท "ุงุฎุชุจุงุฑ Tabby Checkout"
```

### 3. ุงุฎุชุจุงุฑ ูู ุงููุงุฌูุฉ:
1. ุงุฐูุจ ูุตูุญุฉ ุงูููุชุฌุงุช
2. ุฃุถู ููุชุฌ ููุณูุฉ
3. ุงุฐูุจ ููุฏูุน
4. ุงุฎุชุฑ Tabby ูุทุฑููุฉ ุฏูุน
5. ุฃููู ุงูุทูุจ

## ุงูุญููู ุงููุทููุจุฉ ูู Tabby API (ุญุณุจ ุงููุซุงุฆู ุงูุฑุณููุฉ):

### Payment Object:
- โ `amount` (ูุทููุจ)
- โ `currency` (ูุทููุจ)
- โ `buyer.name` (ูุทููุจ)
- โ `buyer.email` (ูุทููุจ)
- โ `buyer.phone` (ูุทููุจ)
- โ `shipping_address.city` (ูุทููุจ)
- โ `shipping_address.address` (ูุทููุจ)
- โ `shipping_address.zip` (ูุทููุจ)
- โ `order.reference_id` (ูุทููุจ)
- โ `order.items[].title` (ูุทููุจ)
- โ `order.items[].quantity` (ูุทููุจ)
- โ `order.items[].unit_price` (ูุทููุจ)
- โ `order.items[].category` (ูุทููุจ)
- โ `buyer_history.registered_since` (ูุทููุจ)
- โ `buyer_history.loyalty_level` (ูุทููุจ)

### Root Object:
- โ `lang` (ูุทููุจ)
- โ `merchant_code` (ูุทููุจ)
- โ `merchant_urls` (ูุทููุจ)

## ูุชูุฌุฉ ุงูุฅุตูุงุญุงุช:
- โ Order model ูุฏุนู Tabby
- โ ุฌููุน ุงูุญููู ุงููุทููุจุฉ ููุฌูุฏุฉ
- โ ุชูุณูู ุฑูู ุงูุฌูุงู ุตุญูุญ
- โ ููุทู ุงูุนูููุฉ ูุญุฏุซ
- โ ุฅูุดุงุก ุงูุทูุจ ูุนูู ุจุฏูู ุฃุฎุทุงุก
- โ Tabby checkout ูุนูู ุจุดูู ุตุญูุญ

## ุงูุฎุทูุงุช ุงูุชุงููุฉ:
1. ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู
2. ุงุฎุชุจุฑ ุฅูุดุงุก ุทูุจ Tabby ูู ุงููุงุฌูุฉ
3. ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก ูู console
4. ุงุฎุชุจุฑ ุงูุนูููุฉ ุงููุงููุฉ ููุฏูุน