<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø­Ø§Ù„Ø§Øª Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            display: inline-block;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 20px;
            font-weight: bold;
        }
        .received { background: #dbeafe; color: #1e40af; }
        .diagnosed { background: #fef3c7; color: #d97706; }
        .waiting_approval { background: #fed7aa; color: #ea580c; }
        .approved { background: #dcfce7; color: #16a34a; }
        .in_progress { background: #e9d5ff; color: #9333ea; }
        .testing { background: #e0e7ff; color: #4f46e5; }
        .ready { background: #bbf7d0; color: #15803d; }
        .completed { background: #f3f4f6; color: #374151; }
        .cancelled { background: #fecaca; color: #dc2626; }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #005a87;
        }
        .error {
            color: red;
            background: #ffe6e6;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            color: green;
            background: #e6ffe6;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .request {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø­Ø§Ù„Ø§Øª Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</h1>
        
        <button onclick="testMaintenanceRequests()">Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</button>
        <button onclick="testStatusTranslation()">Ø§Ø®ØªØ¨Ø§Ø± ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª</button>
        
        <div id="status"></div>
        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        
        // ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª
        const statusTranslations = {
            'received': 'ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…',
            'diagnosed': 'ØªÙ… Ø§Ù„ÙØ­Øµ', 
            'waiting_approval': 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©',
            'approved': 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©',
            'in_progress': 'Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­',
            'testing': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±',
            'ready': 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…',
            'completed': 'Ù…ÙƒØªÙ…Ù„',
            'cancelled': 'Ù…Ù„ØºÙŠ'
        };
        
        function getStatusText(status) {
            return statusTranslations[status] || status;
        }
        
        async function testMaintenanceRequests() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            statusDiv.innerHTML = '<div class="success">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©...</div>';
            resultsDiv.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/maintenance?limit=10`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('ğŸ“¦ Raw maintenance data:', data);
                
                if (data.success && data.data && data.data.requests) {
                    const requests = data.data.requests;
                    statusDiv.innerHTML = `<div class="success">âœ… ØªÙ… Ø¬Ù„Ø¨ ${requests.length} Ø·Ù„Ø¨ ØµÙŠØ§Ù†Ø©!</div>`;
                    
                    let html = '<h2>ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©:</h2>';
                    requests.forEach((request, index) => {
                        const currentStatus = request.status?.current || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        const statusHistory = request.status?.history || [];
                        
                        html += `
                            <div class="request">
                                <h3>ğŸ“± Ø·Ù„Ø¨ Ø±Ù‚Ù…: ${request.requestNumber || index + 1}</h3>
                                <p><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${request.customerInfo?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                <p><strong>Ø§Ù„Ø¬Ù‡Ø§Ø²:</strong> ${request.device?.model || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                <p><strong>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ):</strong> <code>${currentStatus}</code></p>
                                <p><strong>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø¹Ø±Ø¨ÙŠ):</strong> 
                                    <span class="status ${currentStatus}">${getStatusText(currentStatus)}</span>
                                </p>
                                
                                ${statusHistory.length > 0 ? `
                                    <div style="margin-top: 10px;">
                                        <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„Ø§Øª:</strong>
                                        <div style="margin-left: 20px;">
                                            ${statusHistory.map(h => `
                                                <div style="margin: 5px 0;">
                                                    <span class="status ${h.status}">${getStatusText(h.status)}</span>
                                                    <small>(${h.status})</small>
                                                    - ${new Date(h.date).toLocaleDateString('ar-SA')}
                                                    ${h.note ? `<br><em>${h.note}</em>` : ''}
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <details style="margin-top: 10px;">
                                    <summary>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…</summary>
                                    <pre style="background: #f0f0f0; padding: 10px; border-radius: 5px; font-size: 12px; overflow-x: auto;">${JSON.stringify(request, null, 2)}</pre>
                                </details>
                            </div>
                        `;
                    });
                    
                    resultsDiv.innerHTML = html;
                } else {
                    statusDiv.innerHTML = '<div class="error">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØµÙŠØ§Ù†Ø©</div>';
                }
                
            } catch (error) {
                console.error('âŒ Error:', error);
                statusDiv.innerHTML = `<div class="error">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
            }
        }
        
        function testStatusTranslation() {
            const resultsDiv = document.getElementById('results');
            
            let html = '<h2>ğŸ”¤ Ø§Ø®ØªØ¨Ø§Ø± ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª:</h2>';
            
            Object.keys(statusTranslations).forEach(status => {
                html += `
                    <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <strong>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©:</strong> <code>${status}</code><br>
                        <strong>Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:</strong> <span class="status ${status}">${getStatusText(status)}</span>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }
        
        window.onload = function() {
            console.log('ğŸš€ ØµÙØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø­Ø§Ù„Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© Ø¬Ø§Ù‡Ø²Ø©');
        };
    </script>
</body>
</html>